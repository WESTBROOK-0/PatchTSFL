Args in experiment:
Namespace(activation='gelu', affine=0, batch_size=4, c_out=21, checkpoints='./checkpoints/', d_ff=2048, d_layers=1, d_model=512, data='custom', data_path='weather.csv', dec_in=21, decomposition=0, des='Exp', devices='0,1,2,3', distil=True, do_predict=False, dropout=0.05, e_layers=2, embed='timeF', embed_type=0, enc_in=21, factor=3, fc_dropout=0.05, features='M', freq='h', gpu=0, head_dropout=0.0, individual=0, is_training=1, itr=1, kernel_size=25, label_len=48, learning_rate=0.0001, loss='mse', lradj='type3', model='Transformer', model_id='weather_96_336', moving_avg=25, n_heads=8, num_workers=10, output_attention=False, padding_patch='end', patch_len=16, patience=100, pct_start=0.3, pred_len=336, random_seed=2021, revin=1, root_path='./dataset/', seq_len=336, stride=8, subtract_last=0, target='OT', test_flop=False, train_epochs=2, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : weather_96_336_Transformer_custom_ftM_sl336_ll48_pl336_dm512_nh8_el2_dl1_df2048_fc3_ebtimeF_dtTrue_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36216
val 4935
test 10204
	iters: 100, epoch: 1 | loss: 0.6611858
	speed: 0.0484s/iter; left time: 871.5932s
	iters: 200, epoch: 1 | loss: 0.5079934
	speed: 0.0272s/iter; left time: 487.8582s
	iters: 300, epoch: 1 | loss: 0.4838944
	speed: 0.0271s/iter; left time: 483.3965s
	iters: 400, epoch: 1 | loss: 0.5684106
	speed: 0.0279s/iter; left time: 494.5392s
	iters: 500, epoch: 1 | loss: 0.5848308
	speed: 0.0279s/iter; left time: 491.7092s
	iters: 600, epoch: 1 | loss: 0.4504154
	speed: 0.0288s/iter; left time: 503.6482s
	iters: 700, epoch: 1 | loss: 0.6159433
	speed: 0.0279s/iter; left time: 485.3170s
	iters: 800, epoch: 1 | loss: 0.6409616
	speed: 0.0282s/iter; left time: 488.3816s
	iters: 900, epoch: 1 | loss: 0.4242470
	speed: 0.0282s/iter; left time: 486.0351s
	iters: 1000, epoch: 1 | loss: 0.4480191
	speed: 0.0294s/iter; left time: 503.6523s
	iters: 1100, epoch: 1 | loss: 0.4334331
	speed: 0.0275s/iter; left time: 467.7565s
	iters: 1200, epoch: 1 | loss: 0.7793496
	speed: 0.0305s/iter; left time: 516.0709s
	iters: 1300, epoch: 1 | loss: 2.5700479
	speed: 0.0280s/iter; left time: 471.2997s
	iters: 1400, epoch: 1 | loss: 0.5501871
	speed: 0.0272s/iter; left time: 455.1709s
	iters: 1500, epoch: 1 | loss: 0.4426456
	speed: 0.0272s/iter; left time: 451.8788s
	iters: 1600, epoch: 1 | loss: 1.0344975
	speed: 0.0282s/iter; left time: 466.0567s
	iters: 1700, epoch: 1 | loss: 0.4433882
	speed: 0.0302s/iter; left time: 495.0849s
	iters: 1800, epoch: 1 | loss: 0.7651589
	speed: 0.0316s/iter; left time: 514.7333s
	iters: 1900, epoch: 1 | loss: 0.5612147
	speed: 0.0325s/iter; left time: 527.3374s
	iters: 2000, epoch: 1 | loss: 0.4606076
	speed: 0.0319s/iter; left time: 513.9693s
	iters: 2100, epoch: 1 | loss: 0.3971954
	speed: 0.0311s/iter; left time: 497.1256s
	iters: 2200, epoch: 1 | loss: 0.5901703
	speed: 0.0316s/iter; left time: 502.7546s
	iters: 2300, epoch: 1 | loss: 0.6017168
	speed: 0.0264s/iter; left time: 416.7346s
	iters: 2400, epoch: 1 | loss: 0.5229519
	speed: 0.0252s/iter; left time: 396.6384s
	iters: 2500, epoch: 1 | loss: 0.3959551
	speed: 0.0258s/iter; left time: 402.4057s
	iters: 2600, epoch: 1 | loss: 0.5323561
	speed: 0.0251s/iter; left time: 389.8066s
	iters: 2700, epoch: 1 | loss: 0.4671901
	speed: 0.0249s/iter; left time: 383.1228s
	iters: 2800, epoch: 1 | loss: 0.5687448
	speed: 0.0250s/iter; left time: 382.9782s
	iters: 2900, epoch: 1 | loss: 0.9362990
	speed: 0.0255s/iter; left time: 387.4835s
	iters: 3000, epoch: 1 | loss: 0.5732930
	speed: 0.0251s/iter; left time: 379.9205s
	iters: 3100, epoch: 1 | loss: 0.3932292
	speed: 0.0279s/iter; left time: 418.7059s
	iters: 3200, epoch: 1 | loss: 0.3896427
	speed: 0.0299s/iter; left time: 446.0932s
	iters: 3300, epoch: 1 | loss: 0.3546531
	speed: 0.0304s/iter; left time: 449.9089s
	iters: 3400, epoch: 1 | loss: 0.3168629
	speed: 0.0261s/iter; left time: 384.5030s
	iters: 3500, epoch: 1 | loss: 0.3141550
	speed: 0.0258s/iter; left time: 377.3189s
	iters: 3600, epoch: 1 | loss: 0.4547321
	speed: 0.0282s/iter; left time: 409.4061s
	iters: 3700, epoch: 1 | loss: 0.8129637
	speed: 0.0287s/iter; left time: 413.2200s
	iters: 3800, epoch: 1 | loss: 0.4353547
	speed: 0.0299s/iter; left time: 427.3332s
	iters: 3900, epoch: 1 | loss: 0.3715750
	speed: 0.0302s/iter; left time: 428.5700s
	iters: 4000, epoch: 1 | loss: 0.4048823
	speed: 0.0316s/iter; left time: 445.1802s
	iters: 4100, epoch: 1 | loss: 0.4129971
	speed: 0.0313s/iter; left time: 438.8532s
	iters: 4200, epoch: 1 | loss: 0.3733238
	speed: 0.0334s/iter; left time: 464.4266s
	iters: 4300, epoch: 1 | loss: 0.7912837
	speed: 0.0303s/iter; left time: 418.8561s
	iters: 4400, epoch: 1 | loss: 0.4893480
	speed: 0.0281s/iter; left time: 384.7055s
	iters: 4500, epoch: 1 | loss: 0.3409772
	speed: 0.0279s/iter; left time: 379.6640s
	iters: 4600, epoch: 1 | loss: 0.2306964
	speed: 0.0275s/iter; left time: 371.3382s
	iters: 4700, epoch: 1 | loss: 0.3315745
	speed: 0.0285s/iter; left time: 382.0212s
	iters: 4800, epoch: 1 | loss: 0.3670501
	speed: 0.0288s/iter; left time: 383.1981s
	iters: 4900, epoch: 1 | loss: 0.2641405
	speed: 0.0290s/iter; left time: 383.0033s
	iters: 5000, epoch: 1 | loss: 0.3123420
	speed: 0.0291s/iter; left time: 381.6222s
	iters: 5100, epoch: 1 | loss: 1.0602107
	speed: 0.0284s/iter; left time: 368.9419s
	iters: 5200, epoch: 1 | loss: 0.7042704
	speed: 0.0309s/iter; left time: 398.3320s
	iters: 5300, epoch: 1 | loss: 0.4065449
	speed: 0.0287s/iter; left time: 368.2485s
	iters: 5400, epoch: 1 | loss: 0.3140952
	speed: 0.0294s/iter; left time: 373.2099s
	iters: 5500, epoch: 1 | loss: 0.3685600
	speed: 0.0299s/iter; left time: 376.8496s
	iters: 5600, epoch: 1 | loss: 0.3536992
	speed: 0.0302s/iter; left time: 377.6691s
	iters: 5700, epoch: 1 | loss: 0.3410811
	speed: 0.0329s/iter; left time: 408.1971s
	iters: 5800, epoch: 1 | loss: 0.2164229
	speed: 0.0328s/iter; left time: 403.1871s
	iters: 5900, epoch: 1 | loss: 0.3187128
	speed: 0.0327s/iter; left time: 399.4130s
	iters: 6000, epoch: 1 | loss: 0.3284847
	speed: 0.0322s/iter; left time: 390.3938s
	iters: 6100, epoch: 1 | loss: 0.5135748
	speed: 0.0292s/iter; left time: 350.1264s
	iters: 6200, epoch: 1 | loss: 0.3246159
	speed: 0.0280s/iter; left time: 333.3348s
	iters: 6300, epoch: 1 | loss: 0.2894300
	speed: 0.0273s/iter; left time: 322.2594s
	iters: 6400, epoch: 1 | loss: 0.3170142
	speed: 0.0276s/iter; left time: 322.9047s
	iters: 6500, epoch: 1 | loss: 0.8752465
	speed: 0.0277s/iter; left time: 321.5071s
	iters: 6600, epoch: 1 | loss: 0.7470849
	speed: 0.0277s/iter; left time: 318.7607s
	iters: 6700, epoch: 1 | loss: 0.2358413
	speed: 0.0284s/iter; left time: 324.3662s
	iters: 6800, epoch: 1 | loss: 0.2926032
	speed: 0.0290s/iter; left time: 327.7420s
	iters: 6900, epoch: 1 | loss: 0.3420540
	speed: 0.0279s/iter; left time: 313.2081s
	iters: 7000, epoch: 1 | loss: 0.4591309
	speed: 0.0287s/iter; left time: 318.9650s
	iters: 7100, epoch: 1 | loss: 0.2409863
	speed: 0.0299s/iter; left time: 329.2633s
	iters: 7200, epoch: 1 | loss: 0.1806968
	speed: 0.0289s/iter; left time: 315.2995s
	iters: 7300, epoch: 1 | loss: 0.2198729
	speed: 0.0287s/iter; left time: 310.2944s
	iters: 7400, epoch: 1 | loss: 0.3228102
	speed: 0.0291s/iter; left time: 311.9423s
	iters: 7500, epoch: 1 | loss: 0.6857822
	speed: 0.0303s/iter; left time: 321.4009s
	iters: 7600, epoch: 1 | loss: 0.2640909
	speed: 0.0298s/iter; left time: 312.9543s
	iters: 7700, epoch: 1 | loss: 0.3865264
	speed: 0.0316s/iter; left time: 329.2884s
	iters: 7800, epoch: 1 | loss: 0.3355564
	speed: 0.0317s/iter; left time: 326.8649s
	iters: 7900, epoch: 1 | loss: 0.2876055
	speed: 0.0285s/iter; left time: 290.9191s
	iters: 8000, epoch: 1 | loss: 0.8831854
	speed: 0.0306s/iter; left time: 309.3705s
	iters: 8100, epoch: 1 | loss: 0.2658615
	speed: 0.0311s/iter; left time: 310.9021s
	iters: 8200, epoch: 1 | loss: 0.2975427
	speed: 0.0294s/iter; left time: 291.1467s
	iters: 8300, epoch: 1 | loss: 0.2033043
	speed: 0.0283s/iter; left time: 277.1191s
	iters: 8400, epoch: 1 | loss: 2.4206197
	speed: 0.0300s/iter; left time: 290.9426s
	iters: 8500, epoch: 1 | loss: 2.4666872
	speed: 0.0282s/iter; left time: 270.8053s
	iters: 8600, epoch: 1 | loss: 0.2792498
	speed: 0.0280s/iter; left time: 266.2278s
	iters: 8700, epoch: 1 | loss: 0.5062141
	speed: 0.0290s/iter; left time: 273.2519s
	iters: 8800, epoch: 1 | loss: 0.4082862
	speed: 0.0280s/iter; left time: 260.8650s
	iters: 8900, epoch: 1 | loss: 0.8739296
	speed: 0.0295s/iter; left time: 271.3568s
	iters: 9000, epoch: 1 | loss: 0.2970066
	speed: 0.0300s/iter; left time: 273.6293s
Epoch: 1 cost time: 264.0775408744812
Epoch: 1, Steps: 9054 | Train Loss: 0.5385279 Vali Loss: 0.6083937 Test Loss: 0.3974091
Validation loss decreased (inf --> 0.608394).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.2723470
	speed: 0.4503s/iter; left time: 4032.2386s
	iters: 200, epoch: 2 | loss: 0.3699957
	speed: 0.0320s/iter; left time: 283.0022s
	iters: 300, epoch: 2 | loss: 0.4372799
	speed: 0.0326s/iter; left time: 285.6687s
	iters: 400, epoch: 2 | loss: 0.3648385
	speed: 0.0320s/iter; left time: 276.9119s
	iters: 500, epoch: 2 | loss: 0.3335975
	speed: 0.0313s/iter; left time: 267.4955s
	iters: 600, epoch: 2 | loss: 0.3450490
	speed: 0.0314s/iter; left time: 265.1891s
	iters: 700, epoch: 2 | loss: 0.2604173
	speed: 0.0317s/iter; left time: 264.6167s
	iters: 800, epoch: 2 | loss: 0.2539423
	speed: 0.0314s/iter; left time: 259.2264s
	iters: 900, epoch: 2 | loss: 0.7383758
	speed: 0.0317s/iter; left time: 258.8296s
	iters: 1000, epoch: 2 | loss: 0.2298464
	speed: 0.0328s/iter; left time: 264.0870s
	iters: 1100, epoch: 2 | loss: 0.4621430
	speed: 0.0323s/iter; left time: 256.9771s
	iters: 1200, epoch: 2 | loss: 0.3892348
	speed: 0.0308s/iter; left time: 242.0521s
	iters: 1300, epoch: 2 | loss: 0.1937482
	speed: 0.0297s/iter; left time: 230.0835s
	iters: 1400, epoch: 2 | loss: 0.1810901
	speed: 0.0315s/iter; left time: 241.3732s
	iters: 1500, epoch: 2 | loss: 0.4710944
	speed: 0.0306s/iter; left time: 230.9913s
	iters: 1600, epoch: 2 | loss: 0.2604531
	speed: 0.0332s/iter; left time: 247.5431s
	iters: 1700, epoch: 2 | loss: 0.1860824
	speed: 0.0323s/iter; left time: 237.5134s
	iters: 1800, epoch: 2 | loss: 0.2382915
	speed: 0.0309s/iter; left time: 223.9832s
	iters: 1900, epoch: 2 | loss: 0.2218905
	speed: 0.0316s/iter; left time: 226.0325s
	iters: 2000, epoch: 2 | loss: 0.3070650
	speed: 0.0314s/iter; left time: 221.5113s
	iters: 2100, epoch: 2 | loss: 0.1855330
	speed: 0.0313s/iter; left time: 217.6515s
	iters: 2200, epoch: 2 | loss: 0.4137715
	speed: 0.0309s/iter; left time: 212.1027s
	iters: 2300, epoch: 2 | loss: 0.1675068
	speed: 0.0297s/iter; left time: 200.8338s
	iters: 2400, epoch: 2 | loss: 0.3001861
	speed: 0.0299s/iter; left time: 198.7828s
	iters: 2500, epoch: 2 | loss: 0.1306728
	speed: 0.0306s/iter; left time: 200.6082s
	iters: 2600, epoch: 2 | loss: 0.2554557
	speed: 0.0303s/iter; left time: 195.3493s
	iters: 2700, epoch: 2 | loss: 0.2363203
	speed: 0.0300s/iter; left time: 190.8614s
	iters: 2800, epoch: 2 | loss: 0.2733723
	speed: 0.0306s/iter; left time: 191.5473s
	iters: 2900, epoch: 2 | loss: 0.2345968
	speed: 0.0295s/iter; left time: 181.5083s
	iters: 3000, epoch: 2 | loss: 0.1413839
	speed: 0.0298s/iter; left time: 180.5426s
	iters: 3100, epoch: 2 | loss: 0.1672412
	speed: 0.0293s/iter; left time: 174.3723s
	iters: 3200, epoch: 2 | loss: 0.1503824
	speed: 0.0310s/iter; left time: 181.5063s
	iters: 3300, epoch: 2 | loss: 0.2248209
	speed: 0.0282s/iter; left time: 162.0802s
	iters: 3400, epoch: 2 | loss: 0.1138051
	speed: 0.0305s/iter; left time: 172.2607s
	iters: 3500, epoch: 2 | loss: 0.1902826
	speed: 0.0300s/iter; left time: 166.7348s
	iters: 3600, epoch: 2 | loss: 0.1570379
	speed: 0.0293s/iter; left time: 159.8135s
	iters: 3700, epoch: 2 | loss: 0.1211475
	speed: 0.0315s/iter; left time: 168.4205s
	iters: 3800, epoch: 2 | loss: 0.2956243
	speed: 0.0315s/iter; left time: 165.4504s
	iters: 3900, epoch: 2 | loss: 0.1485545
	speed: 0.0292s/iter; left time: 150.2968s
	iters: 4000, epoch: 2 | loss: 0.2227424
	speed: 0.0293s/iter; left time: 148.2699s
	iters: 4100, epoch: 2 | loss: 0.2048863
	speed: 0.0294s/iter; left time: 145.7644s
	iters: 4200, epoch: 2 | loss: 0.1643725
	speed: 0.0287s/iter; left time: 139.1839s
	iters: 4300, epoch: 2 | loss: 0.2664024
	speed: 0.0289s/iter; left time: 137.2024s
	iters: 4400, epoch: 2 | loss: 0.1775710
	speed: 0.0295s/iter; left time: 137.2340s
	iters: 4500, epoch: 2 | loss: 0.6378257
	speed: 0.0305s/iter; left time: 138.9477s
	iters: 4600, epoch: 2 | loss: 0.2249755
	speed: 0.0293s/iter; left time: 130.4131s
	iters: 4700, epoch: 2 | loss: 0.1213427
	speed: 0.0289s/iter; left time: 125.9777s
	iters: 4800, epoch: 2 | loss: 0.1083187
	speed: 0.0296s/iter; left time: 126.0794s
	iters: 4900, epoch: 2 | loss: 0.4429455
	speed: 0.0292s/iter; left time: 121.1825s
	iters: 5000, epoch: 2 | loss: 0.2354639
	speed: 0.0303s/iter; left time: 122.6786s
	iters: 5100, epoch: 2 | loss: 0.1258479
	speed: 0.0293s/iter; left time: 115.6936s
	iters: 5200, epoch: 2 | loss: 0.1273855
	speed: 0.0298s/iter; left time: 115.0060s
	iters: 5300, epoch: 2 | loss: 0.1221432
	speed: 0.0311s/iter; left time: 116.7879s
	iters: 5400, epoch: 2 | loss: 1.6160097
	speed: 0.0297s/iter; left time: 108.6895s
	iters: 5500, epoch: 2 | loss: 0.2867284
	speed: 0.0330s/iter; left time: 117.4072s
	iters: 5600, epoch: 2 | loss: 0.1273262
	speed: 0.0326s/iter; left time: 112.5088s
	iters: 5700, epoch: 2 | loss: 0.2076860
	speed: 0.0315s/iter; left time: 105.6005s
	iters: 5800, epoch: 2 | loss: 0.2321279
	speed: 0.0312s/iter; left time: 101.4613s
	iters: 5900, epoch: 2 | loss: 0.1946545
	speed: 0.0295s/iter; left time: 93.0060s
	iters: 6000, epoch: 2 | loss: 0.2426454
	speed: 0.0272s/iter; left time: 83.1107s
	iters: 6100, epoch: 2 | loss: 0.2146337
	speed: 0.0299s/iter; left time: 88.3411s
	iters: 6200, epoch: 2 | loss: 0.1572661
	speed: 0.0293s/iter; left time: 83.7656s
	iters: 6300, epoch: 2 | loss: 0.0798958
	speed: 0.0290s/iter; left time: 79.8641s
	iters: 6400, epoch: 2 | loss: 0.2756614
	speed: 0.0298s/iter; left time: 79.1818s
	iters: 6500, epoch: 2 | loss: 0.1053804
	speed: 0.0302s/iter; left time: 77.0760s
	iters: 6600, epoch: 2 | loss: 0.2439857
	speed: 0.0278s/iter; left time: 68.3632s
	iters: 6700, epoch: 2 | loss: 0.2256424
	speed: 0.0297s/iter; left time: 69.9331s
	iters: 6800, epoch: 2 | loss: 0.0895681
	speed: 0.0291s/iter; left time: 65.6911s
	iters: 6900, epoch: 2 | loss: 0.2072259
	speed: 0.0292s/iter; left time: 62.9086s
	iters: 7000, epoch: 2 | loss: 0.2295787
	speed: 0.0286s/iter; left time: 58.6897s
	iters: 7100, epoch: 2 | loss: 0.2022223
	speed: 0.0297s/iter; left time: 57.9947s
	iters: 7200, epoch: 2 | loss: 0.1849057
	speed: 0.0312s/iter; left time: 57.8688s
	iters: 7300, epoch: 2 | loss: 0.1378924
	speed: 0.0326s/iter; left time: 57.1632s
	iters: 7400, epoch: 2 | loss: 0.1049959
	speed: 0.0311s/iter; left time: 51.5378s
	iters: 7500, epoch: 2 | loss: 0.1038685
	speed: 0.0322s/iter; left time: 50.0199s
	iters: 7600, epoch: 2 | loss: 0.1007293
	speed: 0.0301s/iter; left time: 43.8394s
	iters: 7700, epoch: 2 | loss: 0.1059669
	speed: 0.0282s/iter; left time: 38.2519s
	iters: 7800, epoch: 2 | loss: 0.1728804
	speed: 0.0269s/iter; left time: 33.7362s
	iters: 7900, epoch: 2 | loss: 0.1049497
	speed: 0.0296s/iter; left time: 34.2220s
	iters: 8000, epoch: 2 | loss: 0.2430858
	speed: 0.0311s/iter; left time: 32.7971s
	iters: 8100, epoch: 2 | loss: 0.0917885
	speed: 0.0287s/iter; left time: 27.4519s
	iters: 8200, epoch: 2 | loss: 1.9935763
	speed: 0.0261s/iter; left time: 22.3474s
	iters: 8300, epoch: 2 | loss: 0.1030364
	speed: 0.0287s/iter; left time: 21.7044s
	iters: 8400, epoch: 2 | loss: 0.1194250
	speed: 0.0290s/iter; left time: 19.0147s
	iters: 8500, epoch: 2 | loss: 0.0895226
	speed: 0.0294s/iter; left time: 16.2913s
	iters: 8600, epoch: 2 | loss: 0.1635503
	speed: 0.0290s/iter; left time: 13.1782s
	iters: 8700, epoch: 2 | loss: 0.1469932
	speed: 0.0292s/iter; left time: 10.3492s
	iters: 8800, epoch: 2 | loss: 0.1208401
	speed: 0.0288s/iter; left time: 7.3500s
	iters: 8900, epoch: 2 | loss: 0.2469667
	speed: 0.0296s/iter; left time: 4.5907s
	iters: 9000, epoch: 2 | loss: 0.2039562
	speed: 0.0300s/iter; left time: 1.6491s
Epoch: 2 cost time: 276.04869651794434
Epoch: 2, Steps: 9054 | Train Loss: 0.3049239 Vali Loss: 0.6855187 Test Loss: 0.5463666
EarlyStopping counter: 1 out of 100
Updating learning rate to 0.0001
>>>>>>>testing : weather_96_336_Transformer_custom_ftM_sl336_ll48_pl336_dm512_nh8_el2_dl1_df2048_fc3_ebtimeF_dtTrue_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10204
mse:0.3974086046218872, mae:0.4548839330673218, rse:0.8279500603675842
