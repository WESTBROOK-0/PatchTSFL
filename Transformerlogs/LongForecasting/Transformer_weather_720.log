Args in experiment:
Namespace(activation='gelu', affine=0, batch_size=4, c_out=21, checkpoints='./checkpoints/', d_ff=2048, d_layers=1, d_model=512, data='custom', data_path='weather.csv', dec_in=21, decomposition=0, des='Exp', devices='0,1,2,3', distil=True, do_predict=False, dropout=0.05, e_layers=2, embed='timeF', embed_type=0, enc_in=21, factor=3, fc_dropout=0.05, features='M', freq='h', gpu=0, head_dropout=0.0, individual=0, is_training=1, itr=1, kernel_size=25, label_len=48, learning_rate=0.0001, loss='mse', lradj='type3', model='Transformer', model_id='weather_96_720', moving_avg=25, n_heads=8, num_workers=10, output_attention=False, padding_patch='end', patch_len=16, patience=100, pct_start=0.3, pred_len=720, random_seed=2021, revin=1, root_path='./dataset/', seq_len=336, stride=8, subtract_last=0, target='OT', test_flop=False, train_epochs=2, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : weather_96_720_Transformer_custom_ftM_sl336_ll48_pl720_dm512_nh8_el2_dl1_df2048_fc3_ebtimeF_dtTrue_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 35832
val 4551
test 9820
	iters: 100, epoch: 1 | loss: 0.7588787
	speed: 0.0570s/iter; left time: 1016.3942s
	iters: 200, epoch: 1 | loss: 0.7244052
	speed: 0.0359s/iter; left time: 635.7393s
	iters: 300, epoch: 1 | loss: 0.9580712
	speed: 0.0348s/iter; left time: 613.5824s
	iters: 400, epoch: 1 | loss: 0.5915610
	speed: 0.0336s/iter; left time: 588.1942s
	iters: 500, epoch: 1 | loss: 0.8657165
	speed: 0.0347s/iter; left time: 603.5718s
	iters: 600, epoch: 1 | loss: 0.9876018
	speed: 0.0342s/iter; left time: 592.7393s
	iters: 700, epoch: 1 | loss: 0.5428276
	speed: 0.0341s/iter; left time: 586.6523s
	iters: 800, epoch: 1 | loss: 0.9200068
	speed: 0.0329s/iter; left time: 563.9033s
	iters: 900, epoch: 1 | loss: 0.8811957
	speed: 0.0340s/iter; left time: 577.9050s
	iters: 1000, epoch: 1 | loss: 0.4719830
	speed: 0.0353s/iter; left time: 597.0274s
	iters: 1100, epoch: 1 | loss: 1.8194597
	speed: 0.0373s/iter; left time: 628.0564s
	iters: 1200, epoch: 1 | loss: 0.6528602
	speed: 0.0418s/iter; left time: 699.5545s
	iters: 1300, epoch: 1 | loss: 0.6602364
	speed: 0.0354s/iter; left time: 588.3633s
	iters: 1400, epoch: 1 | loss: 0.6856500
	speed: 0.0357s/iter; left time: 588.9817s
	iters: 1500, epoch: 1 | loss: 1.0201026
	speed: 0.0363s/iter; left time: 595.5445s
	iters: 1600, epoch: 1 | loss: 0.6103210
	speed: 0.0348s/iter; left time: 567.5098s
	iters: 1700, epoch: 1 | loss: 0.5863290
	speed: 0.0371s/iter; left time: 601.1299s
	iters: 1800, epoch: 1 | loss: 0.4444779
	speed: 0.0378s/iter; left time: 609.6743s
	iters: 1900, epoch: 1 | loss: 0.3835015
	speed: 0.0354s/iter; left time: 567.6987s
	iters: 2000, epoch: 1 | loss: 0.6694852
	speed: 0.0351s/iter; left time: 559.0376s
	iters: 2100, epoch: 1 | loss: 1.5330786
	speed: 0.0342s/iter; left time: 541.0511s
	iters: 2200, epoch: 1 | loss: 0.8174802
	speed: 0.0351s/iter; left time: 550.9709s
	iters: 2300, epoch: 1 | loss: 0.8652539
	speed: 0.0365s/iter; left time: 569.5027s
	iters: 2400, epoch: 1 | loss: 0.9793659
	speed: 0.0348s/iter; left time: 540.5126s
	iters: 2500, epoch: 1 | loss: 0.4893716
	speed: 0.0365s/iter; left time: 562.4227s
	iters: 2600, epoch: 1 | loss: 0.4867957
	speed: 0.0356s/iter; left time: 544.7807s
	iters: 2700, epoch: 1 | loss: 0.8962457
	speed: 0.0388s/iter; left time: 590.4889s
	iters: 2800, epoch: 1 | loss: 0.4347894
	speed: 0.0394s/iter; left time: 595.9746s
	iters: 2900, epoch: 1 | loss: 0.5072533
	speed: 0.0355s/iter; left time: 532.9938s
	iters: 3000, epoch: 1 | loss: 0.5515836
	speed: 0.0367s/iter; left time: 547.7966s
	iters: 3100, epoch: 1 | loss: 0.4690695
	speed: 0.0353s/iter; left time: 522.7005s
	iters: 3200, epoch: 1 | loss: 0.3338796
	speed: 0.0379s/iter; left time: 557.4942s
	iters: 3300, epoch: 1 | loss: 0.6089336
	speed: 0.0388s/iter; left time: 567.6601s
	iters: 3400, epoch: 1 | loss: 0.4418065
	speed: 0.0358s/iter; left time: 519.2710s
	iters: 3500, epoch: 1 | loss: 1.4029703
	speed: 0.0352s/iter; left time: 507.2569s
	iters: 3600, epoch: 1 | loss: 0.5426918
	speed: 0.0360s/iter; left time: 515.2178s
	iters: 3700, epoch: 1 | loss: 1.4986235
	speed: 0.0363s/iter; left time: 515.9382s
	iters: 3800, epoch: 1 | loss: 0.5121032
	speed: 0.0342s/iter; left time: 483.0623s
	iters: 3900, epoch: 1 | loss: 0.6341348
	speed: 0.0341s/iter; left time: 477.9265s
	iters: 4000, epoch: 1 | loss: 0.5224038
	speed: 0.0329s/iter; left time: 458.5615s
	iters: 4100, epoch: 1 | loss: 0.5143628
	speed: 0.0348s/iter; left time: 480.6402s
	iters: 4200, epoch: 1 | loss: 0.6333279
	speed: 0.0348s/iter; left time: 477.6358s
	iters: 4300, epoch: 1 | loss: 0.4052551
	speed: 0.0383s/iter; left time: 521.7263s
	iters: 4400, epoch: 1 | loss: 0.5729655
	speed: 0.0381s/iter; left time: 515.3608s
	iters: 4500, epoch: 1 | loss: 0.6638076
	speed: 0.0388s/iter; left time: 520.7719s
	iters: 4600, epoch: 1 | loss: 0.4540292
	speed: 0.0354s/iter; left time: 471.2621s
	iters: 4700, epoch: 1 | loss: 0.4354535
	speed: 0.0387s/iter; left time: 512.0643s
	iters: 4800, epoch: 1 | loss: 0.6887110
	speed: 0.0397s/iter; left time: 520.2088s
	iters: 4900, epoch: 1 | loss: 0.3555519
	speed: 0.0364s/iter; left time: 473.5072s
	iters: 5000, epoch: 1 | loss: 0.3512633
	speed: 0.0346s/iter; left time: 446.3020s
	iters: 5100, epoch: 1 | loss: 0.4997198
	speed: 0.0339s/iter; left time: 434.8064s
	iters: 5200, epoch: 1 | loss: 0.4734089
	speed: 0.0342s/iter; left time: 435.3222s
	iters: 5300, epoch: 1 | loss: 0.3066016
	speed: 0.0333s/iter; left time: 420.2077s
	iters: 5400, epoch: 1 | loss: 0.4459414
	speed: 0.0338s/iter; left time: 423.5318s
	iters: 5500, epoch: 1 | loss: 0.4302085
	speed: 0.0360s/iter; left time: 447.4339s
	iters: 5600, epoch: 1 | loss: 0.4648061
	speed: 0.0358s/iter; left time: 441.4507s
	iters: 5700, epoch: 1 | loss: 1.4535446
	speed: 0.0343s/iter; left time: 419.4754s
	iters: 5800, epoch: 1 | loss: 0.4650220
	speed: 0.0355s/iter; left time: 430.5916s
	iters: 5900, epoch: 1 | loss: 0.3230335
	speed: 0.0377s/iter; left time: 453.1281s
	iters: 6000, epoch: 1 | loss: 0.3854026
	speed: 0.0410s/iter; left time: 489.0440s
	iters: 6100, epoch: 1 | loss: 0.3283008
	speed: 0.0380s/iter; left time: 449.3115s
	iters: 6200, epoch: 1 | loss: 0.5331460
	speed: 0.0372s/iter; left time: 436.3707s
	iters: 6300, epoch: 1 | loss: 0.3878533
	speed: 0.0391s/iter; left time: 453.8619s
	iters: 6400, epoch: 1 | loss: 0.4817818
	speed: 0.0384s/iter; left time: 442.4288s
	iters: 6500, epoch: 1 | loss: 0.4299426
	speed: 0.0337s/iter; left time: 384.3103s
	iters: 6600, epoch: 1 | loss: 0.4384067
	speed: 0.0336s/iter; left time: 380.0664s
	iters: 6700, epoch: 1 | loss: 0.3218166
	speed: 0.0337s/iter; left time: 378.2332s
	iters: 6800, epoch: 1 | loss: 0.3461317
	speed: 0.0337s/iter; left time: 374.6715s
	iters: 6900, epoch: 1 | loss: 1.3318052
	speed: 0.0337s/iter; left time: 370.8077s
	iters: 7000, epoch: 1 | loss: 1.3684139
	speed: 0.0334s/iter; left time: 364.1185s
	iters: 7100, epoch: 1 | loss: 0.4002102
	speed: 0.0349s/iter; left time: 377.3289s
	iters: 7200, epoch: 1 | loss: 0.4284462
	speed: 0.0350s/iter; left time: 375.0667s
	iters: 7300, epoch: 1 | loss: 0.4270116
	speed: 0.0332s/iter; left time: 352.5783s
	iters: 7400, epoch: 1 | loss: 0.3892633
	speed: 0.0362s/iter; left time: 381.1508s
	iters: 7500, epoch: 1 | loss: 0.2988096
	speed: 0.0352s/iter; left time: 366.6406s
	iters: 7600, epoch: 1 | loss: 0.3507480
	speed: 0.0381s/iter; left time: 393.4145s
	iters: 7700, epoch: 1 | loss: 0.3810444
	speed: 0.0418s/iter; left time: 426.7088s
	iters: 7800, epoch: 1 | loss: 0.3772076
	speed: 0.0370s/iter; left time: 374.4193s
	iters: 7900, epoch: 1 | loss: 1.2720689
	speed: 0.0391s/iter; left time: 391.9204s
	iters: 8000, epoch: 1 | loss: 0.3470661
	speed: 0.0389s/iter; left time: 385.7487s
	iters: 8100, epoch: 1 | loss: 0.2631275
	speed: 0.0349s/iter; left time: 342.2905s
	iters: 8200, epoch: 1 | loss: 0.3203161
	speed: 0.0330s/iter; left time: 320.9731s
	iters: 8300, epoch: 1 | loss: 0.4349759
	speed: 0.0331s/iter; left time: 318.7739s
	iters: 8400, epoch: 1 | loss: 0.3628162
	speed: 0.0326s/iter; left time: 310.2562s
	iters: 8500, epoch: 1 | loss: 0.2664041
	speed: 0.0318s/iter; left time: 299.1377s
	iters: 8600, epoch: 1 | loss: 0.4937547
	speed: 0.0343s/iter; left time: 319.3352s
	iters: 8700, epoch: 1 | loss: 0.3632768
	speed: 0.0356s/iter; left time: 328.3520s
	iters: 8800, epoch: 1 | loss: 0.3693149
	speed: 0.0364s/iter; left time: 331.9508s
	iters: 8900, epoch: 1 | loss: 0.4484218
	speed: 0.0347s/iter; left time: 313.1336s
Epoch: 1 cost time: 323.01999497413635
Epoch: 1, Steps: 8958 | Train Loss: 0.5881648 Vali Loss: 0.6930035 Test Loss: 0.5642030
Validation loss decreased (inf --> 0.693003).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 1.5125359
	speed: 0.5706s/iter; left time: 5054.8250s
	iters: 200, epoch: 2 | loss: 0.3210143
	speed: 0.0352s/iter; left time: 308.6788s
	iters: 300, epoch: 2 | loss: 0.3524510
	speed: 0.0363s/iter; left time: 313.9586s
	iters: 400, epoch: 2 | loss: 0.1918283
	speed: 0.0401s/iter; left time: 342.8154s
	iters: 500, epoch: 2 | loss: 0.3325221
	speed: 0.0385s/iter; left time: 325.5888s
	iters: 600, epoch: 2 | loss: 0.3247920
	speed: 0.0354s/iter; left time: 296.1689s
	iters: 700, epoch: 2 | loss: 0.2560779
	speed: 0.0363s/iter; left time: 300.1384s
	iters: 800, epoch: 2 | loss: 0.3631475
	speed: 0.0372s/iter; left time: 303.8427s
	iters: 900, epoch: 2 | loss: 0.2588444
	speed: 0.0398s/iter; left time: 321.0045s
	iters: 1000, epoch: 2 | loss: 0.3673048
	speed: 0.0358s/iter; left time: 284.6125s
	iters: 1100, epoch: 2 | loss: 1.2524828
	speed: 0.0333s/iter; left time: 261.6787s
	iters: 1200, epoch: 2 | loss: 0.2666101
	speed: 0.0366s/iter; left time: 283.8911s
	iters: 1300, epoch: 2 | loss: 0.3166082
	speed: 0.0377s/iter; left time: 288.3789s
	iters: 1400, epoch: 2 | loss: 0.2505469
	speed: 0.0372s/iter; left time: 281.3739s
	iters: 1500, epoch: 2 | loss: 0.2956268
	speed: 0.0352s/iter; left time: 262.3163s
	iters: 1600, epoch: 2 | loss: 0.2712157
	speed: 0.0343s/iter; left time: 252.1189s
	iters: 1700, epoch: 2 | loss: 0.1980530
	speed: 0.0343s/iter; left time: 249.1647s
	iters: 1800, epoch: 2 | loss: 1.2558527
	speed: 0.0342s/iter; left time: 245.0674s
	iters: 1900, epoch: 2 | loss: 0.2670739
	speed: 0.0362s/iter; left time: 255.8482s
	iters: 2000, epoch: 2 | loss: 0.1979763
	speed: 0.0410s/iter; left time: 285.0824s
	iters: 2100, epoch: 2 | loss: 0.2907469
	speed: 0.0360s/iter; left time: 246.8257s
	iters: 2200, epoch: 2 | loss: 0.3660375
	speed: 0.0334s/iter; left time: 225.8320s
	iters: 2300, epoch: 2 | loss: 0.2574832
	speed: 0.0371s/iter; left time: 247.3517s
	iters: 2400, epoch: 2 | loss: 0.2496203
	speed: 0.0344s/iter; left time: 225.7251s
	iters: 2500, epoch: 2 | loss: 0.2178887
	speed: 0.0366s/iter; left time: 236.1028s
	iters: 2600, epoch: 2 | loss: 0.2881539
	speed: 0.0379s/iter; left time: 241.1619s
	iters: 2700, epoch: 2 | loss: 0.4672720
	speed: 0.0344s/iter; left time: 215.3840s
	iters: 2800, epoch: 2 | loss: 0.2157497
	speed: 0.0357s/iter; left time: 219.6490s
	iters: 2900, epoch: 2 | loss: 0.2991920
	speed: 0.0352s/iter; left time: 213.4571s
	iters: 3000, epoch: 2 | loss: 0.2514388
	speed: 0.0345s/iter; left time: 205.6402s
	iters: 3100, epoch: 2 | loss: 0.4251878
	speed: 0.0346s/iter; left time: 202.8396s
	iters: 3200, epoch: 2 | loss: 0.2229513
	speed: 0.0331s/iter; left time: 190.6392s
	iters: 3300, epoch: 2 | loss: 0.2475049
	speed: 0.0340s/iter; left time: 192.4877s
	iters: 3400, epoch: 2 | loss: 0.1420533
	speed: 0.0353s/iter; left time: 196.0442s
	iters: 3500, epoch: 2 | loss: 0.4078764
	speed: 0.0353s/iter; left time: 192.7014s
	iters: 3600, epoch: 2 | loss: 0.1756990
	speed: 0.0391s/iter; left time: 209.3275s
	iters: 3700, epoch: 2 | loss: 0.2224569
	speed: 0.0400s/iter; left time: 210.2273s
	iters: 3800, epoch: 2 | loss: 0.2145118
	speed: 0.0359s/iter; left time: 185.4623s
	iters: 3900, epoch: 2 | loss: 0.2100011
	speed: 0.0354s/iter; left time: 179.2396s
	iters: 4000, epoch: 2 | loss: 0.1748811
	speed: 0.0344s/iter; left time: 170.4609s
	iters: 4100, epoch: 2 | loss: 0.1349992
	speed: 0.0377s/iter; left time: 183.2447s
	iters: 4200, epoch: 2 | loss: 0.3425049
	speed: 0.0388s/iter; left time: 184.7044s
	iters: 4300, epoch: 2 | loss: 0.9315634
	speed: 0.0362s/iter; left time: 168.8196s
	iters: 4400, epoch: 2 | loss: 0.4245731
	speed: 0.0355s/iter; left time: 162.0653s
	iters: 4500, epoch: 2 | loss: 0.1494577
	speed: 0.0337s/iter; left time: 150.2190s
	iters: 4600, epoch: 2 | loss: 0.2356050
	speed: 0.0335s/iter; left time: 145.8234s
	iters: 4700, epoch: 2 | loss: 0.4330345
	speed: 0.0364s/iter; left time: 155.2170s
	iters: 4800, epoch: 2 | loss: 0.2212423
	speed: 0.0355s/iter; left time: 147.7054s
	iters: 4900, epoch: 2 | loss: 1.1369848
	speed: 0.0344s/iter; left time: 139.4924s
	iters: 5000, epoch: 2 | loss: 0.2602023
	speed: 0.0361s/iter; left time: 142.8865s
	iters: 5100, epoch: 2 | loss: 0.1760355
	speed: 0.0357s/iter; left time: 137.6292s
	iters: 5200, epoch: 2 | loss: 0.2459563
	speed: 0.0389s/iter; left time: 146.1118s
	iters: 5300, epoch: 2 | loss: 0.3287629
	speed: 0.0383s/iter; left time: 140.3109s
	iters: 5400, epoch: 2 | loss: 0.1813437
	speed: 0.0350s/iter; left time: 124.5835s
	iters: 5500, epoch: 2 | loss: 0.1789493
	speed: 0.0356s/iter; left time: 123.2029s
	iters: 5600, epoch: 2 | loss: 0.8990238
	speed: 0.0349s/iter; left time: 117.0998s
	iters: 5700, epoch: 2 | loss: 1.0223759
	speed: 0.0370s/iter; left time: 120.5547s
	iters: 5800, epoch: 2 | loss: 0.8631165
	speed: 0.0387s/iter; left time: 122.2872s
	iters: 5900, epoch: 2 | loss: 0.1064708
	speed: 0.0363s/iter; left time: 110.9466s
	iters: 6000, epoch: 2 | loss: 0.2374868
	speed: 0.0353s/iter; left time: 104.5351s
	iters: 6100, epoch: 2 | loss: 0.1584760
	speed: 0.0340s/iter; left time: 97.2187s
	iters: 6200, epoch: 2 | loss: 0.3903754
	speed: 0.0340s/iter; left time: 93.7682s
	iters: 6300, epoch: 2 | loss: 0.1647055
	speed: 0.0347s/iter; left time: 92.1760s
	iters: 6400, epoch: 2 | loss: 0.1414719
	speed: 0.0343s/iter; left time: 87.8978s
	iters: 6500, epoch: 2 | loss: 0.1701555
	speed: 0.0329s/iter; left time: 80.8216s
	iters: 6600, epoch: 2 | loss: 0.1864894
	speed: 0.0359s/iter; left time: 84.7681s
	iters: 6700, epoch: 2 | loss: 0.1324556
	speed: 0.0341s/iter; left time: 77.0394s
	iters: 6800, epoch: 2 | loss: 0.2453835
	speed: 0.0388s/iter; left time: 83.8126s
	iters: 6900, epoch: 2 | loss: 0.1439407
	speed: 0.0383s/iter; left time: 78.9377s
	iters: 7000, epoch: 2 | loss: 0.1947608
	speed: 0.0322s/iter; left time: 63.0024s
	iters: 7100, epoch: 2 | loss: 0.1200846
	speed: 0.0329s/iter; left time: 61.2425s
	iters: 7200, epoch: 2 | loss: 0.8099764
	speed: 0.0339s/iter; left time: 59.5578s
	iters: 7300, epoch: 2 | loss: 0.1192927
	speed: 0.0332s/iter; left time: 55.0740s
	iters: 7400, epoch: 2 | loss: 0.2063063
	speed: 0.0354s/iter; left time: 55.2047s
	iters: 7500, epoch: 2 | loss: 0.7569154
	speed: 0.0358s/iter; left time: 52.2601s
	iters: 7600, epoch: 2 | loss: 0.1778790
	speed: 0.0354s/iter; left time: 48.0482s
	iters: 7700, epoch: 2 | loss: 0.1539788
	speed: 0.0340s/iter; left time: 42.8242s
	iters: 7800, epoch: 2 | loss: 0.1506137
	speed: 0.0364s/iter; left time: 42.1477s
	iters: 7900, epoch: 2 | loss: 0.2110810
	speed: 0.0348s/iter; left time: 36.8250s
	iters: 8000, epoch: 2 | loss: 0.1437518
	speed: 0.0323s/iter; left time: 31.0151s
	iters: 8100, epoch: 2 | loss: 0.1740404
	speed: 0.0336s/iter; left time: 28.8271s
	iters: 8200, epoch: 2 | loss: 0.2177250
	speed: 0.0335s/iter; left time: 25.4230s
	iters: 8300, epoch: 2 | loss: 0.1663976
	speed: 0.0357s/iter; left time: 23.5530s
	iters: 8400, epoch: 2 | loss: 0.1162683
	speed: 0.0352s/iter; left time: 19.6593s
	iters: 8500, epoch: 2 | loss: 0.3466982
	speed: 0.0359s/iter; left time: 16.4870s
	iters: 8600, epoch: 2 | loss: 0.3219458
	speed: 0.0355s/iter; left time: 12.7468s
	iters: 8700, epoch: 2 | loss: 0.9940918
	speed: 0.0327s/iter; left time: 8.4650s
	iters: 8800, epoch: 2 | loss: 0.1741593
	speed: 0.0323s/iter; left time: 5.1330s
	iters: 8900, epoch: 2 | loss: 0.1243770
	speed: 0.0340s/iter; left time: 2.0059s
Epoch: 2 cost time: 320.7255048751831
Epoch: 2, Steps: 8958 | Train Loss: 0.3130051 Vali Loss: 0.8054726 Test Loss: 0.8037990
EarlyStopping counter: 1 out of 100
Updating learning rate to 0.0001
>>>>>>>testing : weather_96_720_Transformer_custom_ftM_sl336_ll48_pl720_dm512_nh8_el2_dl1_df2048_fc3_ebtimeF_dtTrue_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 9820
mse:0.5642006397247314, mae:0.5519405007362366, rse:0.9884365797042847
