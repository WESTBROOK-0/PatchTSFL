Args in experiment:
Namespace(activation='gelu', affine=0, batch_size=4, c_out=21, checkpoints='./checkpoints/', d_ff=2048, d_layers=1, d_model=512, data='custom', data_path='weather.csv', dec_in=21, decomposition=0, des='Exp', devices='0,1,2,3', distil=True, do_predict=False, dropout=0.05, e_layers=2, embed='timeF', embed_type=0, enc_in=21, factor=3, fc_dropout=0.05, features='M', freq='h', gpu=0, head_dropout=0.0, individual=0, is_training=1, itr=1, kernel_size=25, label_len=48, learning_rate=0.0001, loss='mse', lradj='type3', model='Transformer', model_id='weather_96_96', moving_avg=25, n_heads=8, num_workers=10, output_attention=False, padding_patch='end', patch_len=16, patience=100, pct_start=0.3, pred_len=96, random_seed=2021, revin=1, root_path='./dataset/', seq_len=336, stride=8, subtract_last=0, target='OT', test_flop=False, train_epochs=2, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : weather_96_96_Transformer_custom_ftM_sl336_ll48_pl96_dm512_nh8_el2_dl1_df2048_fc3_ebtimeF_dtTrue_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 36456
val 5175
test 10444
	iters: 100, epoch: 1 | loss: 1.0059496
	speed: 0.0431s/iter; left time: 780.9162s
	iters: 200, epoch: 1 | loss: 0.6403793
	speed: 0.0243s/iter; left time: 437.4566s
	iters: 300, epoch: 1 | loss: 1.7655067
	speed: 0.0247s/iter; left time: 442.3601s
	iters: 400, epoch: 1 | loss: 0.9898125
	speed: 0.0239s/iter; left time: 426.1752s
	iters: 500, epoch: 1 | loss: 0.8421883
	speed: 0.0243s/iter; left time: 430.8827s
	iters: 600, epoch: 1 | loss: 0.5332073
	speed: 0.0245s/iter; left time: 432.5462s
	iters: 700, epoch: 1 | loss: 0.4276503
	speed: 0.0251s/iter; left time: 439.9087s
	iters: 800, epoch: 1 | loss: 0.4702811
	speed: 0.0246s/iter; left time: 428.9834s
	iters: 900, epoch: 1 | loss: 0.3535290
	speed: 0.0245s/iter; left time: 424.7026s
	iters: 1000, epoch: 1 | loss: 0.4040134
	speed: 0.0253s/iter; left time: 436.4691s
	iters: 1100, epoch: 1 | loss: 0.5534315
	speed: 0.0286s/iter; left time: 489.9354s
	iters: 1200, epoch: 1 | loss: 0.7397834
	speed: 0.0272s/iter; left time: 463.3354s
	iters: 1300, epoch: 1 | loss: 0.3587502
	speed: 0.0278s/iter; left time: 469.8832s
	iters: 1400, epoch: 1 | loss: 1.5205832
	speed: 0.0281s/iter; left time: 473.3315s
	iters: 1500, epoch: 1 | loss: 0.4124776
	speed: 0.0257s/iter; left time: 430.6854s
	iters: 1600, epoch: 1 | loss: 0.5211390
	speed: 0.0258s/iter; left time: 428.6724s
	iters: 1700, epoch: 1 | loss: 0.5228220
	speed: 0.0250s/iter; left time: 412.5549s
	iters: 1800, epoch: 1 | loss: 0.3623514
	speed: 0.0255s/iter; left time: 419.1136s
	iters: 1900, epoch: 1 | loss: 0.2620129
	speed: 0.0279s/iter; left time: 456.0245s
	iters: 2000, epoch: 1 | loss: 0.4371916
	speed: 0.0255s/iter; left time: 413.1833s
	iters: 2100, epoch: 1 | loss: 0.4311413
	speed: 0.0248s/iter; left time: 400.6667s
	iters: 2200, epoch: 1 | loss: 0.6098303
	speed: 0.0247s/iter; left time: 395.5279s
	iters: 2300, epoch: 1 | loss: 0.3479519
	speed: 0.0248s/iter; left time: 394.8498s
	iters: 2400, epoch: 1 | loss: 0.3255670
	speed: 0.0239s/iter; left time: 377.7108s
	iters: 2500, epoch: 1 | loss: 0.3403426
	speed: 0.0251s/iter; left time: 395.3730s
	iters: 2600, epoch: 1 | loss: 0.6918864
	speed: 0.0245s/iter; left time: 383.6801s
	iters: 2700, epoch: 1 | loss: 0.4728956
	speed: 0.0257s/iter; left time: 399.4006s
	iters: 2800, epoch: 1 | loss: 0.2819093
	speed: 0.0288s/iter; left time: 444.6963s
	iters: 2900, epoch: 1 | loss: 0.4233475
	speed: 0.0265s/iter; left time: 405.9534s
	iters: 3000, epoch: 1 | loss: 1.7699485
	speed: 0.0243s/iter; left time: 370.1231s
	iters: 3100, epoch: 1 | loss: 0.2181524
	speed: 0.0248s/iter; left time: 375.5461s
	iters: 3200, epoch: 1 | loss: 0.2385343
	speed: 0.0256s/iter; left time: 384.9085s
	iters: 3300, epoch: 1 | loss: 0.2260057
	speed: 0.0284s/iter; left time: 424.5390s
	iters: 3400, epoch: 1 | loss: 0.4428640
	speed: 0.0277s/iter; left time: 411.0168s
	iters: 3500, epoch: 1 | loss: 0.2767926
	speed: 0.0280s/iter; left time: 412.3730s
	iters: 3600, epoch: 1 | loss: 0.4031254
	speed: 0.0254s/iter; left time: 371.5702s
	iters: 3700, epoch: 1 | loss: 0.2395893
	speed: 0.0250s/iter; left time: 362.8162s
	iters: 3800, epoch: 1 | loss: 0.2453775
	speed: 0.0246s/iter; left time: 355.4477s
	iters: 3900, epoch: 1 | loss: 0.2139311
	speed: 0.0248s/iter; left time: 355.0351s
	iters: 4000, epoch: 1 | loss: 0.2009661
	speed: 0.0241s/iter; left time: 342.8387s
	iters: 4100, epoch: 1 | loss: 7.8702068
	speed: 0.0243s/iter; left time: 343.4354s
	iters: 4200, epoch: 1 | loss: 0.2988521
	speed: 0.0247s/iter; left time: 346.4972s
	iters: 4300, epoch: 1 | loss: 0.2130566
	speed: 0.0243s/iter; left time: 337.8444s
	iters: 4400, epoch: 1 | loss: 0.2303854
	speed: 0.0240s/iter; left time: 331.8390s
	iters: 4500, epoch: 1 | loss: 0.3047345
	speed: 0.0245s/iter; left time: 335.7681s
	iters: 4600, epoch: 1 | loss: 0.5698053
	speed: 0.0242s/iter; left time: 329.1720s
	iters: 4700, epoch: 1 | loss: 0.2197541
	speed: 0.0254s/iter; left time: 343.5715s
	iters: 4800, epoch: 1 | loss: 1.3399056
	speed: 0.0260s/iter; left time: 348.6827s
	iters: 4900, epoch: 1 | loss: 0.1923028
	speed: 0.0239s/iter; left time: 318.0857s
	iters: 5000, epoch: 1 | loss: 0.1741711
	speed: 0.0240s/iter; left time: 318.0049s
	iters: 5100, epoch: 1 | loss: 0.4826238
	speed: 0.0260s/iter; left time: 340.9116s
	iters: 5200, epoch: 1 | loss: 0.1888032
	speed: 0.0254s/iter; left time: 330.9461s
	iters: 5300, epoch: 1 | loss: 0.2573538
	speed: 0.0274s/iter; left time: 354.1793s
	iters: 5400, epoch: 1 | loss: 0.3726866
	speed: 0.0294s/iter; left time: 377.5283s
	iters: 5500, epoch: 1 | loss: 0.3057928
	speed: 0.0295s/iter; left time: 375.1438s
	iters: 5600, epoch: 1 | loss: 0.2059082
	speed: 0.0257s/iter; left time: 324.3792s
	iters: 5700, epoch: 1 | loss: 0.1159122
	speed: 0.0258s/iter; left time: 323.6982s
	iters: 5800, epoch: 1 | loss: 0.2002102
	speed: 0.0249s/iter; left time: 309.8585s
	iters: 5900, epoch: 1 | loss: 0.4097771
	speed: 0.0256s/iter; left time: 315.4956s
	iters: 6000, epoch: 1 | loss: 0.1218809
	speed: 0.0272s/iter; left time: 332.6551s
	iters: 6100, epoch: 1 | loss: 0.2561429
	speed: 0.0270s/iter; left time: 327.9824s
	iters: 6200, epoch: 1 | loss: 0.1528537
	speed: 0.0261s/iter; left time: 314.5123s
	iters: 6300, epoch: 1 | loss: 1.7252011
	speed: 0.0270s/iter; left time: 322.5022s
	iters: 6400, epoch: 1 | loss: 0.3747246
	speed: 0.0246s/iter; left time: 291.2485s
	iters: 6500, epoch: 1 | loss: 0.1748549
	speed: 0.0262s/iter; left time: 307.0861s
	iters: 6600, epoch: 1 | loss: 0.5976601
	speed: 0.0250s/iter; left time: 290.4024s
	iters: 6700, epoch: 1 | loss: 0.1702736
	speed: 0.0266s/iter; left time: 306.4070s
	iters: 6800, epoch: 1 | loss: 0.1728289
	speed: 0.0282s/iter; left time: 322.1140s
	iters: 6900, epoch: 1 | loss: 0.1887040
	speed: 0.0259s/iter; left time: 293.1088s
	iters: 7000, epoch: 1 | loss: 0.2286981
	speed: 0.0253s/iter; left time: 283.5516s
	iters: 7100, epoch: 1 | loss: 0.1497516
	speed: 0.0260s/iter; left time: 289.0867s
	iters: 7200, epoch: 1 | loss: 0.3823432
	speed: 0.0270s/iter; left time: 297.8234s
	iters: 7300, epoch: 1 | loss: 0.4381912
	speed: 0.0268s/iter; left time: 293.1759s
	iters: 7400, epoch: 1 | loss: 0.2685674
	speed: 0.0303s/iter; left time: 328.6052s
	iters: 7500, epoch: 1 | loss: 0.2396768
	speed: 0.0308s/iter; left time: 330.4992s
	iters: 7600, epoch: 1 | loss: 0.1520562
	speed: 0.0271s/iter; left time: 288.4338s
	iters: 7700, epoch: 1 | loss: 0.1687639
	speed: 0.0260s/iter; left time: 273.4772s
	iters: 7800, epoch: 1 | loss: 0.1312524
	speed: 0.0264s/iter; left time: 275.4281s
	iters: 7900, epoch: 1 | loss: 0.1736589
	speed: 0.0262s/iter; left time: 271.1163s
	iters: 8000, epoch: 1 | loss: 0.2270532
	speed: 0.0244s/iter; left time: 249.2722s
	iters: 8100, epoch: 1 | loss: 0.1496035
	speed: 0.0268s/iter; left time: 271.1790s
	iters: 8200, epoch: 1 | loss: 0.2381371
	speed: 0.0243s/iter; left time: 243.9449s
	iters: 8300, epoch: 1 | loss: 0.3603111
	speed: 0.0241s/iter; left time: 239.5515s
	iters: 8400, epoch: 1 | loss: 0.3807766
	speed: 0.0258s/iter; left time: 253.4020s
	iters: 8500, epoch: 1 | loss: 0.2360409
	speed: 0.0260s/iter; left time: 252.7349s
	iters: 8600, epoch: 1 | loss: 0.1277251
	speed: 0.0260s/iter; left time: 250.4790s
	iters: 8700, epoch: 1 | loss: 0.4549893
	speed: 0.0252s/iter; left time: 240.0811s
	iters: 8800, epoch: 1 | loss: 0.9033628
	speed: 0.0264s/iter; left time: 249.2977s
	iters: 8900, epoch: 1 | loss: 0.2948064
	speed: 0.0279s/iter; left time: 260.5263s
	iters: 9000, epoch: 1 | loss: 0.8192746
	speed: 0.0250s/iter; left time: 230.9139s
	iters: 9100, epoch: 1 | loss: 0.6164618
	speed: 0.0252s/iter; left time: 230.4463s
Epoch: 1 cost time: 237.5831356048584
Epoch: 1, Steps: 9114 | Train Loss: 0.4478565 Vali Loss: 0.4497637 Test Loss: 0.2415254
Validation loss decreased (inf --> 0.449764).  Saving model ...
Updating learning rate to 0.0001
	iters: 100, epoch: 2 | loss: 0.6321220
	speed: 0.4235s/iter; left time: 3818.2826s
	iters: 200, epoch: 2 | loss: 0.3479540
	speed: 0.0315s/iter; left time: 280.6672s
	iters: 300, epoch: 2 | loss: 0.5826797
	speed: 0.0278s/iter; left time: 245.2928s
	iters: 400, epoch: 2 | loss: 0.5758744
	speed: 0.0297s/iter; left time: 258.8226s
	iters: 500, epoch: 2 | loss: 0.1749813
	speed: 0.0292s/iter; left time: 251.9740s
	iters: 600, epoch: 2 | loss: 0.3038686
	speed: 0.0300s/iter; left time: 255.6140s
	iters: 700, epoch: 2 | loss: 0.2247917
	speed: 0.0323s/iter; left time: 271.8649s
	iters: 800, epoch: 2 | loss: 0.2635073
	speed: 0.0327s/iter; left time: 272.1215s
	iters: 900, epoch: 2 | loss: 0.1467801
	speed: 0.0290s/iter; left time: 238.1895s
	iters: 1000, epoch: 2 | loss: 0.2992389
	speed: 0.0331s/iter; left time: 268.5522s
	iters: 1100, epoch: 2 | loss: 0.2028976
	speed: 0.0295s/iter; left time: 236.2220s
	iters: 1200, epoch: 2 | loss: 0.3467745
	speed: 0.0288s/iter; left time: 227.9010s
	iters: 1300, epoch: 2 | loss: 0.2127265
	speed: 0.0299s/iter; left time: 233.2875s
	iters: 1400, epoch: 2 | loss: 0.1863474
	speed: 0.0284s/iter; left time: 219.3851s
	iters: 1500, epoch: 2 | loss: 0.1678306
	speed: 0.0283s/iter; left time: 215.2747s
	iters: 1600, epoch: 2 | loss: 0.2288236
	speed: 0.0319s/iter; left time: 239.6144s
	iters: 1700, epoch: 2 | loss: 0.1425578
	speed: 0.0315s/iter; left time: 233.7998s
	iters: 1800, epoch: 2 | loss: 0.7378048
	speed: 0.0302s/iter; left time: 221.0141s
	iters: 1900, epoch: 2 | loss: 0.1439003
	speed: 0.0316s/iter; left time: 228.3079s
	iters: 2000, epoch: 2 | loss: 0.1615513
	speed: 0.0307s/iter; left time: 218.7303s
	iters: 2100, epoch: 2 | loss: 1.1686671
	speed: 0.0307s/iter; left time: 215.4616s
	iters: 2200, epoch: 2 | loss: 0.3138066
	speed: 0.0299s/iter; left time: 206.6000s
	iters: 2300, epoch: 2 | loss: 0.3098921
	speed: 0.0285s/iter; left time: 193.9412s
	iters: 2400, epoch: 2 | loss: 0.1047727
	speed: 0.0292s/iter; left time: 195.8616s
	iters: 2500, epoch: 2 | loss: 2.1250861
	speed: 0.0290s/iter; left time: 191.8392s
	iters: 2600, epoch: 2 | loss: 0.2174745
	speed: 0.0273s/iter; left time: 177.6243s
	iters: 2700, epoch: 2 | loss: 0.2072670
	speed: 0.0298s/iter; left time: 191.1514s
	iters: 2800, epoch: 2 | loss: 0.3911829
	speed: 0.0286s/iter; left time: 180.3976s
	iters: 2900, epoch: 2 | loss: 0.1348876
	speed: 0.0291s/iter; left time: 180.9860s
	iters: 3000, epoch: 2 | loss: 0.1058082
	speed: 0.0286s/iter; left time: 175.1438s
	iters: 3100, epoch: 2 | loss: 0.1321966
	speed: 0.0288s/iter; left time: 173.1574s
	iters: 3200, epoch: 2 | loss: 0.3185088
	speed: 0.0279s/iter; left time: 165.2808s
	iters: 3300, epoch: 2 | loss: 0.1400449
	speed: 0.0278s/iter; left time: 161.6949s
	iters: 3400, epoch: 2 | loss: 0.2098155
	speed: 0.0292s/iter; left time: 166.9816s
	iters: 3500, epoch: 2 | loss: 0.1642027
	speed: 0.0289s/iter; left time: 162.3184s
	iters: 3600, epoch: 2 | loss: 0.1387648
	speed: 0.0312s/iter; left time: 171.9451s
	iters: 3700, epoch: 2 | loss: 0.1886774
	speed: 0.0326s/iter; left time: 176.5655s
	iters: 3800, epoch: 2 | loss: 0.3691458
	speed: 0.0326s/iter; left time: 173.5021s
	iters: 3900, epoch: 2 | loss: 0.2938961
	speed: 0.0304s/iter; left time: 158.7473s
	iters: 4000, epoch: 2 | loss: 0.0779244
	speed: 0.0318s/iter; left time: 162.6148s
	iters: 4100, epoch: 2 | loss: 0.1312490
	speed: 0.0301s/iter; left time: 151.1377s
	iters: 4200, epoch: 2 | loss: 0.1091775
	speed: 0.0318s/iter; left time: 156.3182s
	iters: 4300, epoch: 2 | loss: 0.1557943
	speed: 0.0299s/iter; left time: 143.9704s
	iters: 4400, epoch: 2 | loss: 0.2482799
	speed: 0.0286s/iter; left time: 134.7862s
	iters: 4500, epoch: 2 | loss: 0.1665266
	speed: 0.0280s/iter; left time: 129.3732s
	iters: 4600, epoch: 2 | loss: 0.2338253
	speed: 0.0279s/iter; left time: 126.1666s
	iters: 4700, epoch: 2 | loss: 0.3215179
	speed: 0.0276s/iter; left time: 121.9324s
	iters: 4800, epoch: 2 | loss: 0.1610733
	speed: 0.0283s/iter; left time: 122.1121s
	iters: 4900, epoch: 2 | loss: 0.1741726
	speed: 0.0286s/iter; left time: 120.4920s
	iters: 5000, epoch: 2 | loss: 0.1287934
	speed: 0.0290s/iter; left time: 119.3995s
	iters: 5100, epoch: 2 | loss: 0.1607212
	speed: 0.0299s/iter; left time: 119.8995s
	iters: 5200, epoch: 2 | loss: 0.1581696
	speed: 0.0299s/iter; left time: 116.8949s
	iters: 5300, epoch: 2 | loss: 0.1372725
	speed: 0.0296s/iter; left time: 112.7691s
	iters: 5400, epoch: 2 | loss: 0.1907670
	speed: 0.0299s/iter; left time: 111.1312s
	iters: 5500, epoch: 2 | loss: 0.1478016
	speed: 0.0297s/iter; left time: 107.2844s
	iters: 5600, epoch: 2 | loss: 0.0992392
	speed: 0.0299s/iter; left time: 105.0931s
	iters: 5700, epoch: 2 | loss: 0.1702577
	speed: 0.0323s/iter; left time: 110.3338s
	iters: 5800, epoch: 2 | loss: 0.1659896
	speed: 0.0312s/iter; left time: 103.4402s
	iters: 5900, epoch: 2 | loss: 0.2305107
	speed: 0.0320s/iter; left time: 103.0031s
	iters: 6000, epoch: 2 | loss: 0.0960486
	speed: 0.0313s/iter; left time: 97.4374s
	iters: 6100, epoch: 2 | loss: 0.0872394
	speed: 0.0311s/iter; left time: 93.7692s
	iters: 6200, epoch: 2 | loss: 0.1005019
	speed: 0.0310s/iter; left time: 90.4634s
	iters: 6300, epoch: 2 | loss: 0.0894359
	speed: 0.0306s/iter; left time: 86.2756s
	iters: 6400, epoch: 2 | loss: 0.2083713
	speed: 0.0274s/iter; left time: 74.4683s
	iters: 6500, epoch: 2 | loss: 0.1249115
	speed: 0.0258s/iter; left time: 67.5579s
	iters: 6600, epoch: 2 | loss: 0.1349495
	speed: 0.0256s/iter; left time: 64.2858s
	iters: 6700, epoch: 2 | loss: 0.2230616
	speed: 0.0251s/iter; left time: 60.5033s
	iters: 6800, epoch: 2 | loss: 0.2615284
	speed: 0.0264s/iter; left time: 61.2284s
	iters: 6900, epoch: 2 | loss: 0.1219862
	speed: 0.0270s/iter; left time: 59.7564s
	iters: 7000, epoch: 2 | loss: 0.1334792
	speed: 0.0248s/iter; left time: 52.3743s
	iters: 7100, epoch: 2 | loss: 0.1476068
	speed: 0.0258s/iter; left time: 51.9891s
	iters: 7200, epoch: 2 | loss: 0.1881555
	speed: 0.0277s/iter; left time: 53.0614s
	iters: 7300, epoch: 2 | loss: 0.1297464
	speed: 0.0293s/iter; left time: 53.1506s
	iters: 7400, epoch: 2 | loss: 0.2038560
	speed: 0.0317s/iter; left time: 54.3431s
	iters: 7500, epoch: 2 | loss: 0.0882478
	speed: 0.0325s/iter; left time: 52.4208s
	iters: 7600, epoch: 2 | loss: 0.1332238
	speed: 0.0303s/iter; left time: 45.9538s
	iters: 7700, epoch: 2 | loss: 0.1448915
	speed: 0.0277s/iter; left time: 39.2055s
	iters: 7800, epoch: 2 | loss: 0.1329397
	speed: 0.0283s/iter; left time: 37.2081s
	iters: 7900, epoch: 2 | loss: 0.1712309
	speed: 0.0284s/iter; left time: 34.5377s
	iters: 8000, epoch: 2 | loss: 0.1436629
	speed: 0.0274s/iter; left time: 30.5030s
	iters: 8100, epoch: 2 | loss: 0.4899372
	speed: 0.0236s/iter; left time: 23.9204s
	iters: 8200, epoch: 2 | loss: 0.0997185
	speed: 0.0265s/iter; left time: 24.2443s
	iters: 8300, epoch: 2 | loss: 0.0764012
	speed: 0.0288s/iter; left time: 23.4792s
	iters: 8400, epoch: 2 | loss: 0.1451393
	speed: 0.0313s/iter; left time: 22.3686s
	iters: 8500, epoch: 2 | loss: 0.2413081
	speed: 0.0278s/iter; left time: 17.0706s
	iters: 8600, epoch: 2 | loss: 0.2478688
	speed: 0.0304s/iter; left time: 15.6784s
	iters: 8700, epoch: 2 | loss: 0.1187994
	speed: 0.0286s/iter; left time: 11.8688s
	iters: 8800, epoch: 2 | loss: 0.1113142
	speed: 0.0291s/iter; left time: 9.1634s
	iters: 8900, epoch: 2 | loss: 0.0889678
	speed: 0.0282s/iter; left time: 6.0723s
	iters: 9000, epoch: 2 | loss: 0.1075533
	speed: 0.0280s/iter; left time: 3.2233s
	iters: 9100, epoch: 2 | loss: 0.1186000
	speed: 0.0304s/iter; left time: 0.4561s
Epoch: 2 cost time: 269.9012780189514
Epoch: 2, Steps: 9114 | Train Loss: 0.2947663 Vali Loss: 0.4939122 Test Loss: 0.2645587
EarlyStopping counter: 1 out of 100
Updating learning rate to 0.0001
>>>>>>>testing : weather_96_96_Transformer_custom_ftM_sl336_ll48_pl96_dm512_nh8_el2_dl1_df2048_fc3_ebtimeF_dtTrue_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 10444
mse:0.2415250539779663, mae:0.32739049196243286, rse:0.6476395130157471
